[TOC]

# 随机森林分类

## 训练模型并调试参数

```python
# 加载库
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import cross_val_score
from sklearn.metrics import roc_curve, roc_auc_score

def RFC(target_num): # target_num表示将第几个特征作为预测对象

    features_train = new_admet_d.iloc[:,6:]
    target_train = new_admet_d.iloc[:,target_num] 

    # 创建随机森林分类器对象
    randomforest = RandomForestClassifier(random_state=0, n_jobs=-1, class_weight='balanced')

    # 训练模型
    model = randomforest.fit(features_train, target_train)
    
    cv_scores = cross_val_score(randomforest, features_train, target_train, scoring='accuracy', cv=5)
    print('Accuracy:', np.mean(cv_scores))
    
    # 计算特征的重要性
    importances = model.feature_importances_
    impt = pd.DataFrame()
    impt['features'] = new_admet_d.columns[6:]
    impt['importance'] = importances
    show_import = copy.deepcopy(impt.sort_values(by="importance", ascending=False))
    
    return show_import, model
```

## 构建预测模型

```python
features_importance_4, rfc_4 = RFC(4)
```

## 混淆矩阵

```python
sklearn.metrics.confusion_matrix(target_train, rfc_4.predict(features_train))
```



# SVM分类（效率过低、调参麻烦）

```python
from sklearn.svm import SVC
from sklearn.preprocessing import StandardScaler
from sklearn import model_selection
import matplotlib.pyplot as plt
from sklearn.metrics import roc_curve, roc_auc_score
from sklearn.model_selection import RandomizedSearchCV

def SVMC(target_num): # target_num表示将第几个特征作为预测对象

    # 标准化特征
    features_train = new_admet_d.iloc[:,6:]
    target_train = new_admet_d.iloc[:,target_num] 

    scaler = StandardScaler()
    features_train_sd = scaler.fit_transform(features_train)

    svc = SVC(kernel="rbf", random_state=0, probability=True, class_weight='balanced')

    # 创建正则化惩罚的候选超参数区间
    gamma = [0.0005, 0.001, 0.005, 0.01, 0.05, 0.1, 0.5, 1, 10]

    # 创建正则化候选超参数的分布
    C = [0.1, 0.5, 1, 5, 10, 100, 1000]

    # 创建超参数字典
    hyperparameters = dict(C=C, gamma=gamma)

    # 创建随机搜索对象
    randomizedsearch = RandomizedSearchCV(svc, hyperparameters, 
                                     random_state=1, n_iter=50, # 对超参数组合的采样数（即候选模型的数量）由参数 n_iter（迭代次数）指定
                                     cv=5, verbose=0, n_jobs=-1)

    # 训练随机搜索
    best_model = randomizedsearch.fit(features_train_sd, target_train)
    
    # 查看最佳超参数
    print('Best gamma:', best_model.best_estimator_.get_params()['gamma'])
    print('Best C:', best_model.best_estimator_.get_params()['C'])
    
    # 查看交叉验证得分
    print('Accuracy:', best_model.best_score_)
    
    return best_model
```

## 构建预测模型

```python
svmc_1 = SVMC(1)
```

## 预测

```python
# Caco-2
admet_test['Caco-2'] = svmc_1.predict(features_test_sd)
```

