[TOC]



# 异常数据处理

## 全为0变量筛选

```python
def all_0(data):
    count_all_0 = []
    count_0 = []
    for i in range(1, 730):
        count = data[data.iloc[:, i] == 0].shape[0]
        count_0.append(count)
        if count == 1974:
            count_all_0.append(data.columns[i])
    return count_all_0, len(count_all_0), count_0
```

## 统计变量为0的比例

```python
filtrate = pd.DataFrame()
filtrate['features'] = admet_d.columns[1:730]
filtrate['the number of 0'] = count_0
filtrate['percents'] = count_0/(np.ones(729) * 1974)
filtrate.head()
```

## 统计## 标准偏差<0.05的变量

```python
stdev = pd.read_excel('E:/21数学建模/stdev.xlsx') # 用excel计算好的标准差为0的变量
st = stdev.iloc[:,0].values.tolist()
filtrate['sd<0.05'] = np.zeros(729)
for i in range(729):
    for s in st:
        if filtrate.iloc[i, 0] == s:
            filtrate.iloc[i, 3] = 1
filtrate.head()
```

## 剔除变量值为0占比90%以上的变量&标准偏差小于0.05的变量

```python
new_filtrate = pd.DataFrame()
new_filtrate = filtrate[filtrate['percents'] < 0.9] # new_filtrate = filtrate[filtrate['the number of 0'] != 1974]
new_filtrate_1 = new_filtrate[new_filtrate['sd<0.05'] == 0]
new_filtrate_1.shape
new_filtrate_1.head()
```

## 剔除高度相关变量

```python
# 筛选非高度相关变量
features = admet_d.iloc[:,1:730]
df = features.loc[:,[column for column in new_filtrate_1['features']]]
dfData = df.corr()

low_cor = []

for i in range(len(dfData)):
    high_cor_count = 0
    for j in range(i+1, len(dfData)):
        if dfData.iloc[j, i] >= 0.9:
            high_cor_count += 1
    if high_cor_count > 0:
        continue
    low_cor.append(dfData.columns[i])
    

new_features = new_filtrate_1['features'].values.tolist()
indexes = []

for i in range(len(new_filtrate_1)):
    if new_features[i] in low_cor:
        indexes.append(i)

new_filtrate_2 = new_filtrate_1.iloc[indexes, :]
new_filtrate_2.head()

# 构建新数据集
new_features_3 = new_filtrate_2['features'].values.tolist()
new_columns = [0, 730, 731, 732, 733, 734]

for i in range(1, 730):
    if  admet_d.columns[i] in new_features_3:
        new_columns.append(i)

new_admet_d = admet_d.iloc[:, new_columns]
new_admet_d.head()
```

## 查看变量分类是否均衡

```python
balance = pd.DataFrame(index=['Caco-2','CYP3A4','hERG','HOB','MN'])

balance['1_num'] = [sum(new_admet_d.iloc[:,i]) for i in range(1,6)]
balance['0_num'] = [1974-d for d in balance['1_num']]
balance['1_per'] = balance['1_num']/(np.ones(5)*1974)
balance['0_per'] = balance['0_num']/(np.ones(5)*1974)

balance

import matplotlib.pyplot as plt
plt.style.use( 'ggplot')
colors=[ 'lightskyblue', 'pink'] # 自定义颜色
plt.rcParams['font.sans-serif']=['SimHei'] #用来正常显示中文标签
plt.rcParams['axes.unicode_minus']=False #用来正常显示负号

plt.figure(figsize=(9, 6))

# 将横、纵坐标轴标准化处理，保证饼图是一个正圆，否则为椭圆
plt.axes(aspect= 'equal')

for i in range(5):
    plt.subplot(2, 3, i+1) #设置多个图组合
    
    if balance.iloc[i, 2] > balance.iloc[i, 3]:
        explode = [0.1, 0]
    else:
        explode = [0, 0.1]

    # 绘制饼图
    plt.pie(x = balance.iloc[i,[2,3]], labels=['分类1', '分类0'], 
            explode = explode, # 突出显示 
            colors = colors, # 设置饼图的自定义填充色
            autopct = '%.2f%%', # 设置百分比的格式，这里保留一位小数
            #pctdistance= 0.8, # 设置百分比标签与圆心的距离
            #labeldistance = 1.15, # 设置教育水平标签与圆心的距离
            startangle = 180,# 设置饼图的初始角度
            textprops = { 'fontsize': 12, 'color': 'k'},
            shadow=True)# 设置文本标签的属性值
            # frame =1) #是否显示饼图的图框，这里设置显示 
            #center = (1.8, 1.8), # 设置饼图的原点


    # 删除x轴和y轴的刻度
    plt.xticks()
    plt.yticks()

    # 添加图标题
    plt.title(balance.index[i], size=15)

# 显示图形
plt.show()
```